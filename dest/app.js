var express=require("express"),path=require("path"),favicon=require("serve-favicon"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),flash=require("connect-flash"),multer=require("multer"),routes=require("./routes/index"),settings=require("./settings"),session=require("express-session"),MongoStore=require("connect-mongo")(session),logger=require("./common/log"),app=express();app.set("port",process.env.PORT||3e3),app.set("views",path.join(__dirname,"views")),app.set("view engine","ejs"),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0})),app.use(cookieParser()),app.use(express["static"](path.join(__dirname,"public"))),app.use(session({secret:settings.cookieSecret,key:settings.db,cookie:{maxAge:2592e6},store:new MongoStore({db:settings.db,host:settings.host,port:settings.port}),resave:!0,saveUninitialized:!0})),app.use(flash()),app.use(multer({dest:"./public/images",rename:function(e,s){return s}})),logger.use(app),routes(app),app.listen(app.get("port"),function(){console.log("Express server listening on port "+app.get("port"))});